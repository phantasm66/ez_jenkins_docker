node {
    label 'docker_build'

	environment {
   		EZ_DOCKER_HUB_REGISTRY = credentials('docker-hub-credentials')
	}

    stage('Clone repository...') {
        checkout scm
    }

    /* Enter our ez_jenkins_docker project sub-directory */
    dir ('redis') {

        stage('Build & tag image...') {
            sh '/usr/bin/docker build -t phantasm66/ez_redis .'
        }

        /* NOTE: tests on the built app are done in a downstream jenkins job */

        stage('Push image to our docker registry...') {
			sh '/usr/bin/docker login -u EZ_DOCKER_HUB_REGISTRY_USR -p EZ_DOCKER_HUB_REGISTRY_PSW'
			sh '/usr/bin/docker push phantasm66/ez_redis'
        }

    }
}
